!!! 5
//if lt IE 7
  <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en">
//if IE 7
  <html class="no-js lt-ie9 lt-ie8" lang="en">
//if IE 8
  <html class="no-js lt-ie9" lang="en">
//[if gt IE 8]><!
html(class='no-js', lang='en')
  //<![endif]
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')

    title= 'Arter'
    meta(name='description', content='A place to buy and sell posters of student art')
    meta(name='author', content='Varun Singh')
    // [if lt IE 9]
      <script>
      'abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video'.replace(/\w+/g,function(n){document.createElement(n)})
      </script>
    //<![endif]->
    script
      document.documentElement.className += 'js';

    // Bootstrap: Le HTML5 shim, for IE6-8 support of HTML elements
    //[if lt IE 9]
      script(src="http://html5shim.googlecode.com/svn/trunk/html5.js")
    //<![endif]

    style
      body {
        padding-top: 60px;
      }

    link(rel='stylesheet', type='text/css', href='/stylesheets/bs/docs/assets/css/bootstrap.css')
    link(rel='stylesheet', type='text/css', href='/stylesheets/bootstrap.less.css')

    link(rel="stylesheet", href="css/main.css")
    link(rel="stylesheet", href="stylesheets/myStyles.less.css")

    script
      GLBL = {};
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')
    script(src='/javascripts/jquery.min.js')
    script(type='text/javascript', src='/javascripts/underscore-1.3.1.js')
    script(type='text/javascript', src='/javascripts/backbone-0.9.1.js')
    script(type='text/javascript', src='/javascripts/backbone.validation.js')

    <!-- Le fav and touch icons -->
    //
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    -each cssScript in cssScripts
      link(rel='stylesheet', href= cssScript)
    -each script in scripts
      script(type='text/javascript', src= script)
    //

    - if (typeof(user) !== 'undefined' && user && user.username)
      - userLoggedIn = true
    - else
      - userLoggedIn = false

    // Fonts
      <script type="text/javascript" src="http://use.typekit.com/qvh7yaa.js"></script>
      <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
      | <link rel="stylesheet" type="text/css" href="//webputty.commondatastorage.googleapis.com/agtzfmNzc2ZpZGRsZXIMCxIEUGFnZRjM7EQM.css" />
      | <script type="text/javascript">(function(w,d){if(w.location!=w.parent.location||w.location.search.indexOf('__preview_css__')>-1){var t=d.createElement('script');t.type='text/javascript';t.async=true;t.src='http://www.webputty.net/js/agtzfmNzc2ZpZGRsZXIMCxIEUGFnZRjM7EQM';(d.body||d.documentElement).appendChild(t);}})(window,document);</script>

  body
    #entire-page
      #title OpenSpace
      #signup
      script(type='text/template', id='signup1T')
        #signup1.well
          span.signupHeader Oh hey there
          .signupText
            | Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis vehicula diam non turpis egestas vel facilisis leo posuere. Mauris tincidunt, quam at euismod imperdiet, metus orci viverra nunc, a volutpat velit purus lacinia orci. Nam faucibus felis vitae sapien dignissim dignissim. Vivamus vitae metus magna, eget auctor dui. Sed ac arcu et ante feugiat pretium at quis eros. Donec in arcu elit, eget commodo enim.
          form#emailForm(enctype="text")
            input.required.input(name='email', placeholder='Enter Brown or RISD email', type='text', minlength='5')
            input.btn(type='submit', name='submitEmail', value='Start')
            #emailErrorLabel
      script(type='text/template', id='signup2T')
        #signup2.well
          .row-fluid
            .span6
              span.signupHeader Privacy Policy
              .signupText
                | Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis vehicula diam non turpis egestas vel facilisis leo posuere. Mauris tincidunt, quam at euismod imperdiet, metus orci viverra nunc, a volutpat velit purus lacinia orci. Nam faucibus felis vitae sapien dignissim dignissim. Vivamus vitae metus magna, eget auctor dui. Sed ac arcu et ante feugiat pretium at quis eros. Donec in arcu elit, eget commodo enim.
            .span6
              form#nameForm(enctype="text")
                input.required.input(name='name', placeholder='Full Name', type='text')
                #nameErrorLabel.errorLabel
                input.required.input(name='password', placeholder='Password', type='password')
                #passwordErrorLabel.errorLabel
                input.required.input(name='password2', placeholder='Confirm Password', type='password')
                #password2ErrorLabel.errorLabel
                input.required.input(name='username', placeholder='Username', type='text')
                #usernameErrorLabel.errorLabel
                input.btn(type='submit', name='submitName', value='Go')
      script(type='text/template', id='signup3T')
        #signup3.well
          .row-fluid
            .span12
              span.signupHeader Thanks!
              #signupText
      script(type='text/template', id='signingUp')
        | Signing you up...
      script(type='text/template', id='signupSucceeded')
        | Success! You are signed up.
      script(type='text/template', id='signupFailed')
        | Signup Failed
        form
          input(id='tryAgainBtn', type='button', value='Try again?')

      form#uploadForm.form-horizontal.center-content(method='post', enctype="multipart/form-data", action='https://whitewalls.s3.amazonaws.com/')
        fieldset
          legend Upload a Poster
          //a(href='/Multiupload') New, multi-pdf uploader!
          input(id='s3_policy', name='policy', type='hidden')
          input(id='s3_key', name='key', type='hidden')
          input(id='s3_AWSAccessKeyId', name='AWSAccessKeyId', type='hidden')
          input(id='s3_acl', name='acl', type='hidden')
          //input(id='s3_success_action_redirect', name='success_action_redirect', type='hidden')
          input(id='s3_success_action_status', name='success_action_status', type='hidden')
          input(id='s3_signature', name='signature', type='hidden')
          input(id='s3_Content-Type', name='Content-Type', type='hidden')
          //
            <input type="hidden" name="key" value="uploads/${filename}">
            <input type="hidden" name="AWSAccessKeyId" value="YOUR_AWS_ACCESS_KEY">
            <input type="hidden" name="acl" value="private">
            <input type="hidden" name="success_action_redirect" value="http://localhost/">
            <input type="hidden" name="policy" value="YOUR_POLICY_DOCUMENT_BASE64_ENCODED">
            <input type="hidden" name="signature" value="YOUR_CALCULATED_SIGNATURE">
            <input type="hidden" name="Content-Type" value="image/jpeg">
          .control-group
            label.control-label(for='title') Title
            .controls
              input#uploadTitle.required.input(name='file', id='fileId', type='file')
          .actions
            input.btn.btn-primary(type='submit', value='Upload', id='submitBtn')
            button.btn(type='reset') Cancel
  script(type='text/javascript', src='/javascripts/project.js')


script
  $(function() {
    function addIframe() {
      $('iframe').remove();
      var subframe = document.createElement('iframe');
      document.body.appendChild(subframe);
      $('iframe').hide();
      subframe.src = "iframe.html";
    };
    addIframe();
    checkForSubmit = function() {
      var timeout = setInterval(function() {
        if ($('iframe').contents().length != 0) {
          // Not received yet
        } else {
          // Got a response!
          clearInterval(timeout);
          addIframe();
        }
      }, 100);
    }
    $( "#submitBtn" ).click(function(event) {
      event.preventDefault();
      var _file;
      _file = $("#fileId").val().replace(/.+[\\\/]/, "");

      _file = 'adsf';
      $.ajax({
        url: "/gets3credentials/" + _file,
        dataType: "text",
        success: function(res, status) {
          res = JSON.parse(JSON.parse(res)); // TODO: WTF
          $('#s3_AWSAccessKeyId').val(res.s3KeyId);
          $('#s3_signature').val(res.s3Signature);
          $('#s3_policy').val(res.s3PolicyBase64);

          //$('#s3_success_action_redirect').val(res.s3Redirect);
          $('#s3_success_action_status').val(res.s3RedirectStatus);
          //$('#s3_key').val('${filename}');
          $('#s3_key').val(res.s3Key);
          $('#s3_acl').val(res.s3Acl);
          $('#s3_Content-Type').val(res.s3ContentType);
          var formData = $('#uploadForm').serialize();
          //top.GLOBAL_sendFormData(formData);
          top.GLOBAL_sendFormData();
          checkForSubmit();
          //$('#uploadForm').submit();
          //$('#uploadForm').submit(function() {return false;});
        },
        error: function(res, status, error) {//do some error handling here
          console.log('error', res, status, error);
        }
      });
    });
  })
